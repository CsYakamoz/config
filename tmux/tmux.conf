# tmux version: 3.3a

# basic {{{ #
    # using ` as prefix
    unbind C-b
    set -g prefix '`'
    bind '`' send-prefix

    # entering copy-mode by prefix-[, and using vi mode when in copy-mode
    set -g mode-keys vi
    # when in copy-mode, v to start selection, y to copy selected area
    bind -T copy-mode-vi v send-keys -X begin-selection
    bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

    set -g default-terminal "screen-256color"
    set -sa terminal-overrides ',xterm-256color*:Tc'

    set -sg escape-time 10

    set -g history-limit 65535

    set -g mouse on

    set -g status-interval 5

    set -g allow-rename off
    set -g automatic-rename off

    set -g renumber-windows on

    set -g base-index 1
    set -g pane-base-index 1

    set -g monitor-activity on

    set -g aggressive-resize off

    set -g focus-events on

    set -g pane-border-status off
    # Auto hide pane-border-status line when only one pane is displayed (see tmux/tmux#566)
    set-hook -g 'after-new-window'   'run-shell -b "if [ \#{window_panes} -eq 1 ]; then tmux set pane-border-status off; fi"'
    set-hook -g 'after-kill-pane'    'run-shell -b "if [ \#{window_panes} -eq 1 ]; then tmux set pane-border-status off; fi"'
    set-hook -g 'pane-exited'        'run-shell -b "if [ \#{window_panes} -eq 1 ]; then tmux set pane-border-status off; fi"'
    set-hook -g 'after-split-window' 'run-shell -b "if [ \#{window_panes} -gt 1 ]; then tmux set pane-border-status top; fi"'
# }}} basic #

# Variable {{{ #
    # Notice: hex colors value should be use lowercase or start with '##'
    # refer: https://github.com/tmux/tmux/issues/2507#issuecomment-747082554
    tmth_based_color='#fdf6e3'
    tmth_active_color='#e39b7b'
    tmth_high_color='#93b259'
    tmth_black_color='#000000'
    tmth_gray_color='#aaaaaa'

    tmth_zoom_flag="^Z"
    tmth_zoom_color='#ff0000'
    tmth_sync_flag="^S"

    tmth_session_icon="|Owo|"

    tmth_enable_plugin=1
# }}} Variable #

# appearance {{{ #
    set -g status-position top
    set -g status-justify centre

    set -g status-bg "${tmth_based_color}"

    set -g pane-border-style "fg=${tmth_high_color}"
    set -g pane-active-border-style "fg=${tmth_active_color}"
    set -g pane-border-format "[#P:#{pane_current_path}]"

    set -g status-left-length 20
    set -g status-left-style "fg=${tmth_based_color},bg=${tmth_high_color}"
    set -g status-left "${tmth_session_icon} #S "

    set -g status-right-length 150
    set -g status-right-style "fg=${tmth_based_color},bg=${tmth_high_color}"
    set -g status-right "#[fg=${tmth_zoom_color}]#{?window_zoomed_flag, ${tmth_zoom_flag},}#[default]"
    set -ga status-right "#{?pane_synchronized, ${tmth_sync_flag},}#[default]"
    if-shell '[ ${tmth_enable_plugin} -eq 1 ]' \
        'set -ga status-right " #{sysstat_cpu} | #{sysstat_mem} |"'
    set -ga status-right "#{?client_prefix,#[bg=${tmth_active_color}],} %a %h-%Y/%m/%d-%H:%M "

    set -g window-status-separator ""
    set -g window-status-style "fg=${tmth_gray_color},bg=${tmth_based_color}"
    set -g window-status-format ' #I:#W '

    set -g window-status-current-style "fg=${tmth_black_color},bg=${tmth_active_color}"
    set -g window-status-current-format ' #I:#W '

    set -g window-status-last-style "fg=${tmth_black_color},bg=${tmth_based_color}"

    set -g message-style "fg=${tmth_active_color},bg=${tmth_based_color}"
    set -g mode-style "fg=${tmth_based_color},bg=${tmth_active_color}"
# }}} appearance #

# key-binding {{{ #
    # refer: https://github.com/tmux-plugins/tmux-pain-control

    # open a new window in the current path of pane
    bind c new-window -c "#{pane_current_path}"

    # pane-splitting, -f means full width/height
    unbind '"'
    bind '-' splitw -v -c '#{pane_current_path}'
    bind '_' splitw -fv -c '#{pane_current_path}'
    unbind '%'
    bind '\' splitw -h -c '#{pane_current_path}'
    bind '|' splitw -fh -c '#{pane_current_path}'

    # window-moving, like vim, -r means support repeated-press
    bind -r M-h swap-window -d -t -1
	bind -r M-l swap-window -d -t +1

    # reload config
    bind r source-file ~/.tmux.conf \; display-message "Config reloaded..."

    # pane-navigation
    bind k select-pane -U
    bind j select-pane -D
    bind h select-pane -L
    bind l select-pane -R

    # pane-resizing, -r means support repeated-press
    bind -r ^k resizep -U 5
    bind -r ^j resizep -D 5
    bind -r ^h resizep -L 5
    bind -r ^l resizep -R 5

    # switch-to-last-window/session, -n mean plain key-combination
    bind -n M-w last-window
    bind -n M-s switch-client -l

    # killer
    bind X kill-window

    # send pane to window
    bind-key g command-prompt -p "send pane to which window:"  "join-pane -t '%%'"
# }}} key-binding #

# plugin {{{ #
    set -g @plugin 'samoshkin/tmux-plugin-sysstat'
    set -g @sysstat_cpu_view_tmpl 'C:#{cpu.pused}'
    set -g @sysstat_mem_view_tmpl 'M:#{mem.pused}'
    set -g @plugin 'tmux-plugins/tmux-resurrect'
    set -g @plugin 'laktak/extrakto' # required bash 5.0+

    # https://github.com/tmux-plugins/tpm/blob/master/docs/automatic_tpm_installation.md
    if "test ! -d ~/.tmux/plugins/tpm" \
       "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

    run '~/.tmux/plugins/tpm/tpm'
# }}} plugin #

# vim: set sw=4 ts=4 sts=4 et foldmarker={{{,}}} foldmethod=marker foldlevel=0:
